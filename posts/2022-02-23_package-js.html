<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit"><meta name="author" content="HeZulong"><meta name="keywords" content="何祖龙, hezulong, zulong"><meta name="description" content="何祖龙"><meta name="theme-color" content="#000000"><link rel="icon" href="/logo.png" type="image/svg+xml"><link href="//fonts.googleapis.com/css2?family=Fira+Code&amp;family=Inter:wght@200;400;600&amp;display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="//fonts.googleapis.com/css2?family=Kaisei+Decol:wght@400;500;700&amp;display=swap" rel="stylesheet"><title>前端常规打包工具</title><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" async="" crossorigin="" src="/assets/app.9d3f2d14.js"></script><link rel="modulepreload" href="/assets/vendor.8b079578.js"><link rel="stylesheet" href="/assets/app.c1706c9e.css"><link rel="modulepreload" crossorigin="" href="/assets/2022-02-23_package-js.e7a1c5bf.js"><link rel="modulepreload" crossorigin="" href="/assets/Post.e8c0b109.js"><meta name="description" content="何祖龙的个人网站, hezulong's Portfolio"><meta property="og:title" content="前端常规打包工具"><meta name="head:count" content="2"></head><body class="font-sans text-gray-700 dark:text-gray-200"><div id="app" data-server-rendered="true"><!--[--><header class="header z-40" data-v-7ecc8847=""><a href="/" class="w-8 h-8 absolute lg:fixed m-7 select-none outline-none" focusable="false" data-v-7ecc8847=""><div class="bg-accentLight rounded-full w-8 h-8" data-v-7ecc8847=""></div></a><nav class="nav" data-v-7ecc8847=""><div class="spacer" data-v-7ecc8847=""></div><div class="right" data-v-7ecc8847=""><a href="/posts" class="" data-v-7ecc8847=""><span class="<md:hidden" data-v-7ecc8847="">Blog</span><svg style="vertical-align:sub" class="inline md:hidden" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" data-v-7ecc8847=""><path fill="currentColor" d="M26 30H6a2.002 2.002 0 0 1-2-2V4a2.002 2.002 0 0 1 2-2h20a2.002 2.002 0 0 1 2 2v24a2.002 2.002 0 0 1-2 2ZM6 4v24h20V4Z"></path><path fill="currentColor" d="M9 7h11v2H9zm0 5h7v2H9z"></path></svg></a><a href="/talks" class="<md:hidden" data-v-7ecc8847="">Talks </a><a href="/projects" class="" data-v-7ecc8847=""><span class="<md:hidden" data-v-7ecc8847="">Projects</span><svg style="vertical-align:sub" class="inline md:hidden" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" data-v-7ecc8847=""><path fill="currentColor" d="M11 24h10v2H11zm2 4h6v2h-6zm3-26A10 10 0 0 0 6 12a9.19 9.19 0 0 0 3.46 7.62c1 .93 1.54 1.46 1.54 2.38h2c0-1.84-1.11-2.87-2.19-3.86A7.2 7.2 0 0 1 8 12a8 8 0 0 1 16 0a7.2 7.2 0 0 1-2.82 6.14c-1.07 1-2.18 2-2.18 3.86h2c0-.92.53-1.45 1.54-2.39A9.18 9.18 0 0 0 26 12A10 10 0 0 0 16 2z"></path></svg></a><!----><!----><!----></div></nav></header><main class="px-7 py-10"><!--[--><div class="prose m-auto mb-8"><h1 class="mb-0">前端常规打包工具</h1><p class="opacity-50 !-mt-2">02月23日 <span>· 10分钟</span></p><p class="opacity-50 !-mt-6 italic">当年学习打包工具记录下，受限于当时技术有限，很多描述囫囵吞枣，于 2020/07/14 重新整理。</p></div><article><!--[--><div class="prose m-auto"><p></p><div class="table-of-contents"><ul><li><a href="#_1-为什么我们需要打包工具">1. 为什么我们需要打包工具</a><ul><li><a href="#_1-1-前端">1.1 前端</a></li><li><a href="#_1-2-javascript-的简介">1.2 JavaScript 的简介</a></li></ul></li><li><a href="#_2-打包工具">2. 打包工具</a><ul><li><a href="#_2-1-介绍">2.1 介绍</a></li><li><a href="#_2-2-使用总结">2.2 使用总结</a></li><li><a href="#_2-3-如何选择">2.3 如何选择</a></li></ul></li><li><a href="#_3-个人打包配置">3. 个人打包配置</a></li></ul></div><p></p><p>任何行业都会有能力参差不齐的工作者，近几年的前端演变，我也在这股潮流中，从来不敢忘记学习，深怕自己被淘汰，但是技术这玩意，你不学自然有人学习，我们只要做好自己就行。打包工具是为了更好的管理<code>html</code>, <code>css</code>, <code>javascript</code>。如果您是一位非从事前端的开发，那么使用可以锦上添花，不使用也没关系。但是作为前端，这些理论上是基础的技能，我们应该多多擅用，可以帮助我们更好更快的处理代码。</p><h2 id="_1-为什么我们需要打包工具" tabindex="-1">1. 为什么我们需要打包工具 <a class="header-anchor" href="#_1-为什么我们需要打包工具" aria-hidden="true">#</a></h2><h3 id="_1-1-前端" tabindex="-1">1.1 前端 <a class="header-anchor" href="#_1-1-前端" aria-hidden="true">#</a></h3><p>一般我们说前端，通常指结构层<code>html</code>，表现层<code>css</code>，行为层<code>javascript</code>。<code>html</code>好比是房子的地基，<code>css</code>和 <code>javascript</code>是房子的建筑材料，这三个部分一起组成个漂亮的房子。</p><p>所以我们不能将他们分开说，某某部分是个房子，只有三个一起才能组成一个漂亮的房子。</p><h3 id="_1-2-javascript-的简介" tabindex="-1">1.2 JavaScript 的简介 <a class="header-anchor" href="#_1-2-javascript-的简介" aria-hidden="true">#</a></h3><p>这几年，<code>javascript</code>发展非常快速，特别是在2015年，更是有一个质的飞跃。</p><h4 id="_1-2-1-ecma" tabindex="-1">1.2.1 ECMA <a class="header-anchor" href="#_1-2-1-ecma" aria-hidden="true">#</a></h4><p>说到<code>javascript</code>，就要说下Web标准的组织协会，<strong>ECMA</strong>，它是“European Computer Manufactures Association”的缩写，中文称<strong>欧洲计算机制造联合会</strong>，1961年成立，旨在建立统一的电脑操作格式标准–包括程序语言和输入输出的组织。</p><h4 id="_1-2-2-javascript" tabindex="-1">1.2.2 JavaScript <a class="header-anchor" href="#_1-2-2-javascript" aria-hidden="true">#</a></h4><p>2015年，<code>javascript</code>引入许多新的语法糖，而且制定过程当中，还有很多组织和个人不断提交新功能。事情很快就变得清楚了，不可能在一个版本里面包括所有将要引入的功能。</p><p>常规的做法是先发布<code>6.0</code>版，过一段时间再发<code>6.1</code>版，然后是<code>6.2</code>版、<code>6.3</code>版等等 ，这个2015年之前<code>javascript</code>现在习惯称为<code>ECMAScript5</code>，而之后称为<code>ECMAScript6</code>。</p><p>标准委员会商定后最终决定，标准在每年的 6 月份正式发布一次，作为当年的正式版本。接下来的时间，就在这个版本的基础上做改动，直到下一年的 6 月份，草案就自然变成了新一年的版本。这样一来，就不需要以前的版本号了，只要用年份标记就可以了。</p><p>因此，<code>ES6</code>既是一个历史名词，也是一个泛指，含义是 5.1 版以后的<code>javascript</code>的下一代标准，涵盖了<code>ES2015</code>、<code>ES2016</code>、<code>ES2017</code>等等，而<code>ES2015</code>则是正式名称，特指该年发布的正式版本的语言标准。本书中提到<code>ES6</code>的地方，一般是指<code>ES2015</code>标准，但有时也是泛指“下一代 JavaScript 语言”。</p><ul><li><p>问题一：<em>关于<code>ECMAScript</code>和<code>JavaScript</code>是什么关系 ？</em></p><p>回答：从现在的角度来看，二者是可以互换的。即<code>ECMAScript</code>是<code>JavaScript</code>，<code>JavaScript</code>是<code>ECMAScript</code>。</p></li><li><p>问题二：<em><code>ECMAScript 6</code>和<code>ECMAScript 2015</code>是什么关系 ?</em></p><p>回答：<code>ECMAScript 6</code>泛指下一代<code>JavaScript</code>语言，<code>ECMAScript 2015</code>指的是 2015年的 JavaScript 标准；</p></li><li><p>总结</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// es6 泛指下一代 JavaScript 语言，当时部分人也会认为特指ES2015</span>
ECMAScript6<span class="token punctuation">.</span><span class="token number">0</span>  <span class="token operator">=</span>  ECMAScript2015 <span class="token operator">=</span> es2015  <span class="token operator">=</span>  <span class="token function">es6</span><span class="token punctuation">(</span>部分人会这么认为<span class="token punctuation">)</span>
ECMAScript6<span class="token punctuation">.</span><span class="token number">1</span>  <span class="token operator">=</span>  ECMAScript2016 <span class="token operator">=</span> es2016  <span class="token operator">=</span>  <span class="token function">es7</span><span class="token punctuation">(</span>部分人会这么认为<span class="token punctuation">)</span>
ECMAScript6<span class="token punctuation">.</span><span class="token number">2</span>  <span class="token operator">=</span>  ECMAScript2017 <span class="token operator">=</span> es2017  <span class="token operator">=</span>  <span class="token function">es8</span><span class="token punctuation">(</span>部分人会这么认为<span class="token punctuation">)</span>
</code></pre></li></ul><h4 id="_1-2-3-浏览器的遭遇" tabindex="-1">1.2.3 浏览器的遭遇 <a class="header-anchor" href="#_1-2-3-浏览器的遭遇" aria-hidden="true">#</a></h4><p>很尴尬的是，JavaScript发展很快，但是浏览器跟不上脚本更新的进度。一方面给出了标准，一方面却不能直接在浏览器上使用。</p><p>这就出现了<code>Babel</code>，<code>Babel</code>自称是 JavaScript 编译器，它的作用就是将ES6新语法转成ES5，即现在浏览器可识别的脚本（基本现在是针对老版 IE 内核）。</p><p>但是使用 Babel 编译也有缺陷，那就是每一次保存，都需要手动的使用命令行编译，而且编译过程中还需要相关联的包配合使用，很繁琐。<strong>所以，打包工具就出现了，它可以帮助做这些繁琐的工作。</strong></p><h2 id="_2-打包工具" tabindex="-1">2. 打包工具 <a class="header-anchor" href="#_2-打包工具" aria-hidden="true">#</a></h2><h3 id="_2-1-介绍" tabindex="-1">2.1 介绍 <a class="header-anchor" href="#_2-1-介绍" aria-hidden="true">#</a></h3><p>仅介绍 4 款主流的打包工具：<code>grunt</code>， <code>gulp</code>，<code>webpack</code>， <code>rollup</code>，以发布时间为顺序。</p><ol><li><p><code>Grunt</code>：最老牌的打包工具，它运用配置的思想来写打包脚本，一切皆配置，所以会出现比较多的配置项，诸如<code>option</code>，<code>src</code>，<code>dest</code>等等。而且不同的插件可能会有自己扩展字段，认知成本高，运用的时候需要明白各种插件的配置规则。</p></li><li><p><code>Gulp</code>：用代码方式来写打包脚本，并且代码采用流式的写法，只抽象出了<code>gulp.src</code>, <code>gulp.pipe</code>, <code>gulp.dest</code>, <code>gulp.watch</code> 接口，运用相当简单。更易于学习和使用，使用gulp的代码量能比grunt少一半左右。<em>PS:此介绍的是<code>gulp3</code>，在<code>gulp4</code>不可用</em></p></li><li><p><code>Webpack</code>: 是模块化管理工具和打包工具。通过 loader 的转换，任何形式的资源都可以视作模块，比如 CommonJs 模块、AMD 模块、ES6 模块、CSS、图片等。它可以将许多松散的模块按照依赖和规则打包成符合生产环境部署的前端资源。还可以将按需加载的模块进行代码分隔，等到实际需要的时候再异步加载。它定位是模块打包器，而 Gulp/Grunt 属于构建工具。Webpack 可以代替 Gulp/Grunt 的一些功能，但不是一个职能的工具，可以配合使用。</p></li><li><p><code>Rollup</code>：下一代 ES6 模块化工具，最大的亮点是利用 ES6 模块设计，利用<code>tree-shaking</code>生成更简洁、更简单的代码。一般而言，对于应用使用 Webpack，对于类库使用 Rollup；需要代码拆分(Code Splitting)，或者很多静态资源需要处理，再或者构建的项目需要引入很多 CommonJS 模块的依赖时，使用 webpack。代码库是基于 ES6 模块，而且希望代码能够被其他人直接使用，使用 Rollup。</p></li></ol><h3 id="_2-2-使用总结" tabindex="-1">2.2 使用总结 <a class="header-anchor" href="#_2-2-使用总结" aria-hidden="true">#</a></h3><ul><li><code>Grunt</code>：MPA，老牌打包工具，基于文件为媒介（运行慢，零散的脚本文件一当多起来就受到影响</li><li><code>Gulp</code>：MPA，易学，基于 nodejs 的 steam 流打包</li><li><code>Webpack</code>：SPA，目前最强大的打包工具，但是过于臃肿，如何单纯打包js不推荐</li><li><code>Roleup</code>：MPA，tree-shaking特性（针对es6，按需打包，多余的不要，目前（2018，vuex,react主流使用）</li></ul><h3 id="_2-3-如何选择" tabindex="-1">2.3 如何选择 <a class="header-anchor" href="#_2-3-如何选择" aria-hidden="true">#</a></h3><p>如果你一个都不熟悉的话，那么我直接推荐 <code>webpack</code>，官方文档非常详细，更新频率很高。而且在其他的打包工具在处理非网页文件（比如svg, png, vue等）基本还是需要借助它来实现。最关键现在的脚手架主流依旧是它。</p><p>如果在处理文件需要关注前端三剑客的话，那么 <code>grunt</code> 和 <code>gulp</code> 会更好点，这两者我直接推荐 <code>gulp</code>，除非你已经很熟悉 <code>grunt</code>了。</p><p>如果你更加在意脚本代码的简洁精炼，那么可以使用<code>rollup</code>。（<small style="color:#666">PS:我目前主要使用的打包工具，搭建可以使用的 es6 环境可见我<a href="https://www.cnblogs.com/blackcat/p/12027440.html" target="_blank" rel="noopener">这篇文章</a></small>）</p><p>如果你还要更加精炼一点，这里新出来一个新的打包工具，免插件式<code>parcel</code>。</p><h2 id="_3-个人打包配置" tabindex="-1">3. 个人打包配置 <a class="header-anchor" href="#_3-个人打包配置" aria-hidden="true">#</a></h2><p>在打包上，我个人注重的是配置从简单到复杂，所以我分开使用。<code>css</code> 打包选择了<code>gulp</code>，2个任务，3个插件，有一个插件是为了编译<code>scss</code>，如果直接使用<code>css</code>，那么这个插件也可以去除。</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 任务一：编译</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/scss/*.scss'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">outputStyle</span><span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 插件一：编译scss</span>
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> showError<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 插件二：自动添加浏览器前缀</span>
      <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&gt; 1%'</span><span class="token punctuation">,</span> <span class="token string">'last 4 versions'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cascade</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">remove</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">cleanCss</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 插件三：压缩样式</span>
      <span class="token literal-property property">compatibility</span><span class="token operator">:</span> <span class="token string">'ie8'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'keep-breaks'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'../dist/css'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 任务二：观察</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'watch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'src/scss/*.scss'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'compile'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p><code>ECMAScript</code> 个人现在基本使用es6，所以在打包脚本上我选择了<code>rollup</code>，只提取有用的代码，配置上参考<code>react</code>官方配置文档</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'rollup-plugin-node-resolve'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'rollup-plugin-commonjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> eslint <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-eslint'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> uglify <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-uglify'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> env <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前环境：%s'</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/js/index.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/js/index.js'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'atom'</span><span class="token punctuation">,</span>
      banner<span class="token punctuation">,</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">eslint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 检测js代码语法格式</span>
    <span class="token literal-property property">formatter</span><span class="token operator">:</span> <span class="token string">'codeframe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'src/js/**/*.js'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 提取所依赖的代码</span>
    <span class="token literal-property property">jsnext</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 编译es6 -&gt; es5</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">'node_modules/**'</span> <span class="token comment">// 只编译我们的源代码</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 将commonjs 转成 es6 </span>
<span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> configs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  v<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins

  <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v<span class="token punctuation">.</span>watch <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 监听脚本的变化</span>
      <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token string">'src/js/**'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules/**'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token function">uglify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 压缩脚本</span>
        <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">pure_getters</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">unsafe</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">unsafe_comps</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> v
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><p><code>html</code> 个人不做任何处理，可以在上线压缩减少文件的体积，压缩直接使用<code>gulp3</code></p><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 任务一</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'testHtmlmin'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">removeComments</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//清除HTML注释</span>
    <span class="token literal-property property">collapseWhitespace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//压缩HTML</span>
    <span class="token literal-property property">collapseBooleanAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//省略布尔属性的值 &lt;input checked="true"/&gt; ==&gt; &lt;input /&gt;</span>
    <span class="token literal-property property">removeEmptyAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//删除所有空格作属性值 &lt;input id="" /&gt; ==&gt; &lt;input /&gt;</span>
    <span class="token literal-property property">removeScriptTypeAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//删除&lt;script&gt;的type="text/javascript"</span>
    <span class="token literal-property property">removeStyleLinkTypeAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//删除&lt;style&gt;和&lt;link&gt;的type="text/css"</span>
    <span class="token literal-property property">minifyJS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//压缩页面JS</span>
    <span class="token literal-property property">minifyCSS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//压缩页面CSS</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/html/*.html'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">htmlmin</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 使用gulp-htmlmin插件</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist/html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><!--]--></article><div class="prose m-auto mt-8 mb-8"><a href="/posts" class="font-mono no-underline opacity-50 hover:opacity-75">cd ..</a></div><!--]--><footer class="prose m-auto py-20 flex"><span class="text-sm">2018 - PRESENT © HeZulong</span><div class="flex-auto"></div></footer></main><!--]--></div><script></script></body></html>