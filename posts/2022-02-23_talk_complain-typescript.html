<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit"><meta name="author" content="HeZulong"><meta name="keywords" content="何祖龙, hezulong, zulong"><meta name="description" content="何祖龙"><meta name="theme-color" content="#000000"><link rel="icon" href="/logo.png" type="image/svg+xml"><link href="//fonts.googleapis.com/css2?family=Fira+Code&amp;family=Inter:wght@200;400;600&amp;display=swap" rel="stylesheet"><title>吐槽 TypeScript</title><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" async="" crossorigin="" src="/assets/app.239269e7.js"></script><link rel="modulepreload" href="/assets/vendor.8b079578.js"><link rel="stylesheet" href="/assets/app.c1706c9e.css"><link rel="modulepreload" crossorigin="" href="/assets/2022-02-23_talk_complain-typescript.ebdbf582.js"><link rel="modulepreload" crossorigin="" href="/assets/Post.cd1528ad.js"><meta name="description" content="何祖龙的个人网站, hezulong's Portfolio"><meta property="og:title" content="吐槽 TypeScript"><meta name="head:count" content="2"></head><body class="font-sans text-gray-700 dark:text-gray-200"><div id="app" data-server-rendered="true"><!--[--><header class="header z-40" data-v-7ecc8847=""><a href="/" class="w-8 h-8 absolute lg:fixed m-7 select-none outline-none" focusable="false" data-v-7ecc8847=""><div class="bg-accentLight rounded-full w-8 h-8" data-v-7ecc8847=""></div></a><nav class="nav" data-v-7ecc8847=""><div class="spacer" data-v-7ecc8847=""></div><div class="right" data-v-7ecc8847=""><a href="/posts" class="" data-v-7ecc8847=""><span class="<md:hidden" data-v-7ecc8847="">Blog</span><svg style="vertical-align:sub" class="inline md:hidden" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" data-v-7ecc8847=""><path fill="currentColor" d="M26 30H6a2.002 2.002 0 0 1-2-2V4a2.002 2.002 0 0 1 2-2h20a2.002 2.002 0 0 1 2 2v24a2.002 2.002 0 0 1-2 2ZM6 4v24h20V4Z"></path><path fill="currentColor" d="M9 7h11v2H9zm0 5h7v2H9z"></path></svg></a><a href="/talks" class="<md:hidden" data-v-7ecc8847="">Talks </a><a href="/projects" class="" data-v-7ecc8847=""><span class="<md:hidden" data-v-7ecc8847="">Projects</span><svg style="vertical-align:sub" class="inline md:hidden" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" data-v-7ecc8847=""><path fill="currentColor" d="M11 24h10v2H11zm2 4h6v2h-6zm3-26A10 10 0 0 0 6 12a9.19 9.19 0 0 0 3.46 7.62c1 .93 1.54 1.46 1.54 2.38h2c0-1.84-1.11-2.87-2.19-3.86A7.2 7.2 0 0 1 8 12a8 8 0 0 1 16 0a7.2 7.2 0 0 1-2.82 6.14c-1.07 1-2.18 2-2.18 3.86h2c0-.92.53-1.45 1.54-2.39A9.18 9.18 0 0 0 26 12A10 10 0 0 0 16 2z"></path></svg></a><!----><!----><!----></div></nav></header><main class="px-7 py-10"><!--[--><div class="prose m-auto mb-8"><h1 class="mb-0">吐槽 TypeScript</h1><p class="opacity-50 !-mt-2">02月23日 <span>· 8分钟</span></p><p class="opacity-50 !-mt-6 italic">文章首发于 2020/08/18，这里只是迁移</p></div><article><!--[--><div class="prose m-auto"><p>说起 TypeScript，认识的还蛮早，因为不喜欢强类型，所以并不是很喜欢。但是随着越来越多的程序员使用，慢慢的我也重新审视自己，是不是太井底之蛙了。</p><p>所以我最近又重新拾起，一边阅读一些优秀的 TypeScript 源码，一边编写小工具 <a href="https://www.npmjs.com/package/resize-detector-typescript" target="_blank" rel="noopener">resize-detector</a>，为了巩固下所学。终于结束了，对比之前我使用 js 直接开发功能，在使用 ts 时候，谈下我使用后的一些想法：</p><p>首先是环境搭建，说实话真的要看个人，你是喜欢简单版还是进阶版还是完整版，因为我是基于一个开源的第三方库编写，自然需要完整。然后我就<em>到处</em>找各种配置，终于配制出适合自己的。不过因为是初版，到现在依旧不是很满意，但勉强可以使用了。</p><p>那么环境搭建完毕，就要开始写代码了，写代码途中我发现，之前声明了如下的类型：</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token constant">XXX</span></span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span>
</code></pre><p>因为我需要使用这种类型，结果无意间看到一个 type，叫做 <code>PropertyKey</code>，和我这种类型一模一样，这就很尴尬了，等于我重复定义了一个变量。而这个 <code>PropertyKey</code> 它是个全局变量，这是内置的。有人可能会说你不会去参考看下 lib.dom 库啊，可是关键如果一个新手来做，他知道这个库吗？</p><p>这是写类型遇到的第一个问题：<strong>内置类型/接口不知道如何寻找</strong>。</p><p>当然第一个问题对于我来说还是很好解决的，那么第二个问题就有些复杂，就是我写了一个公共的回调函数，在 ts 中因为不同的接口实现都定义了一套自己的回调类型，结果就是我写的这个方法不停的在转化类型（目前也是这么做的，应该可以优化）。于是我就想到能不能根据谁使用，那么根据使用者来推断类型。答案自然是有的，毕竟我是个后来者，在网络上的列子中我知道了 <code>extends</code> 和 <code>infer</code> 关键字，说真的，至少当时我激动了，有解决方案。可以网络上说的真的太基础，或者官网示例，虽然看了很多，但是说清楚的没几个，至于到现在我对这个 <code>infer</code> 只有特定环境才可以明白如何写，接口就是我依旧没有找到方法去实现我的想法（有一篇<a href="https://my.oschina.net/u/4318809/blog/4293100" target="_blank" rel="noopener">文章</a> 我个人觉着讲的还行，因为不是盲目的粘贴复制）。这是我遇到的第二个问题：<strong>如何编写高校的检测类型</strong>。</p><p>遇到的第三个就是关于<code>eslint</code>，我使用的是<code>ts</code>团队自家产品 <code>@typescript-eslint/eslint-plugin</code>，可以说提示的还不错，但是每次在写到<code>js</code>中的<code>object</code>类型我就是很纠结，因为推荐我使用<code>Record</code>类型，我也听话了，用上后发现一个很尴尬的，我自己定义的<code>option</code>对象不能被<code>Record</code>类型兼容，我定义的<code>options</code>类型就是<code>&lt;string, unknow&gt;</code>，<code>Record</code>类型也是<code>Record&lt;string, unknow&gt;</code>为什么不行呢，后来我换成了<code>object</code>类型就可以，就目前而言，关于对象的表示我依旧不是很清楚怎么写，是写<code>Object</code>，还是<code>object</code>，还是<code>Record</code>，虽然<code>eslint</code>推荐使用<code>Record</code>，我是真的迷糊了。这只是我举得一个列子，其实就是想说我遇到的第三个问题：<strong>到底应该如何使用合理的类型</strong>。</p><p><s>那么第四个问题，我需要向原始对象<code>HTMLElement</code>添加属性，但是<code>ts</code>提示不可以，我也能理解，所以我为了不污染这个<code>HTMLElement</code>，我重新声明了一个新的接口（假设是<code>IDomNode</code>）继承<code>HTMLElement</code>，然后我就基于我声明的新的接口<code>IDomNode</code>写，写到最后都是没有问题的，发布完我测试，发现当然调用方法传入<code>HTMLElement</code>，提示不行，因为<code>HTMLElement</code>没有<code>IDomNode</code>上的一些属性，关键我这个<code>IDomNode</code>又不是一上来就有，难道我需要自己再写个方法将每一个<code>HTMLElement</code>初始化成<code>IDomNode</code>，最后我先使用了折中办法，将所有的<code>IDomNode</code>类的属性变成可选，这就导致只要是使用到<code>IDomNode</code>的属性就必须先判空，虽然我可以肯定他们存在，但是<code>ts</code>不信他们是存在的。所以我又写了一堆方法判空，感觉显得很多余。</s> [今天突然开窍了，我应该在内部自行将<code>HTMLElement</code>转成 <code>IDomNode</code>转化才可以，果真还是使用的姿势不对。]</p><p>差不多了，其实网上很多评论对比，当然都不及自己去写写，使用中出现很多问题，即便到现在发布了，我也不敢说这是稳定版，只能发布了一个alpha版本。TypeScript 正如字面可以很好的检测类型，但是多数需要自己合理编写一些检测类型来推断。</p><p>说真的我觉得还是蛮搞笑，以前直接写<code>es5</code>，后来<code>es6</code>出来了，写<code>es6</code>，但是为了照顾老浏览器，最后将<code>es6</code>转成<code>es5</code>在编写，现在是写<code>typescript</code>，再转成es6，感觉有毒啊😄。</p><p>感觉是不是我使用<code>typescript</code>的姿势不对，就目前而言，更多感觉像是枷锁，也许后面使用多了可能会好一些。那时候就会出现<strong>真相警告</strong>了吧。</p></div><!--]--></article><div class="prose m-auto mt-8 mb-8"><a href="/posts" class="font-mono no-underline opacity-50 hover:opacity-75">cd ..</a></div><!--]--><footer class="prose m-auto py-20 flex"><span class="text-sm">2018 - PRESENT © HeZulong</span><div class="flex-auto"></div></footer></main><!--]--></div><script></script></body></html>