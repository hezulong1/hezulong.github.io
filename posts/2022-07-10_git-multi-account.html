<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit"><meta name="author" content="HeZulong"><meta name="keywords" content="何祖龙, hezulong, zulong"><meta name="description" content="何祖龙"><meta name="theme-color" content="#000000"><link rel="icon" href="/logo.png" type="image/svg+xml"><link href="//fonts.googleapis.com/css2?family=Fira+Code&amp;family=Inter:wght@200;400;600&amp;display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="//fonts.googleapis.com/css2?family=Kaisei+Decol:wght@400;500;700&amp;display=swap" rel="stylesheet"><title>Git 多账户配置</title><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" async="" crossorigin="" src="/assets/app.8250e82d.js"></script><link rel="modulepreload" href="/assets/vendor.8b079578.js"><link rel="stylesheet" href="/assets/app.c1706c9e.css"><link rel="modulepreload" crossorigin="" href="/assets/2022-07-10_git-multi-account.81a43881.js"><link rel="modulepreload" crossorigin="" href="/assets/Post.8d318d4e.js"><meta name="description" content="何祖龙的个人网站, hezulong's Portfolio"><meta property="og:title" content="Git 多账户配置"><meta name="head:count" content="2"></head><body class="font-sans text-gray-700 dark:text-gray-200"><div id="app" data-server-rendered="true"><!--[--><header class="header z-40" data-v-7ecc8847=""><a href="/" class="w-8 h-8 absolute lg:fixed m-7 select-none outline-none" focusable="false" data-v-7ecc8847=""><div class="bg-accentLight rounded-full w-8 h-8" data-v-7ecc8847=""></div></a><nav class="nav" data-v-7ecc8847=""><div class="spacer" data-v-7ecc8847=""></div><div class="right" data-v-7ecc8847=""><a href="/posts" class="" data-v-7ecc8847=""><span class="<md:hidden" data-v-7ecc8847="">Blog</span><svg style="vertical-align:sub" class="inline md:hidden" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" data-v-7ecc8847=""><path fill="currentColor" d="M26 30H6a2.002 2.002 0 0 1-2-2V4a2.002 2.002 0 0 1 2-2h20a2.002 2.002 0 0 1 2 2v24a2.002 2.002 0 0 1-2 2ZM6 4v24h20V4Z"></path><path fill="currentColor" d="M9 7h11v2H9zm0 5h7v2H9z"></path></svg></a><a href="/talks" class="<md:hidden" data-v-7ecc8847="">Talks </a><a href="/projects" class="" data-v-7ecc8847=""><span class="<md:hidden" data-v-7ecc8847="">Projects</span><svg style="vertical-align:sub" class="inline md:hidden" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" data-v-7ecc8847=""><path fill="currentColor" d="M11 24h10v2H11zm2 4h6v2h-6zm3-26A10 10 0 0 0 6 12a9.19 9.19 0 0 0 3.46 7.62c1 .93 1.54 1.46 1.54 2.38h2c0-1.84-1.11-2.87-2.19-3.86A7.2 7.2 0 0 1 8 12a8 8 0 0 1 16 0a7.2 7.2 0 0 1-2.82 6.14c-1.07 1-2.18 2-2.18 3.86h2c0-.92.53-1.45 1.54-2.39A9.18 9.18 0 0 0 26 12A10 10 0 0 0 16 2z"></path></svg></a><!----><!----><!----></div></nav></header><main class="px-7 py-10"><!--[--><div class="prose m-auto mb-8"><h1 class="mb-0">Git 多账户配置</h1><p class="opacity-50 !-mt-2">07月10日 <span>· 10分钟</span></p><!----></div><article><!--[--><div class="prose m-auto"><p>平时工作中的 Git 账户和私人 Git 账户是不同的，在提交代码时候，之前基本很少注意提交名称。今天稍微调整顺便记录下如何统一自己的提交名称。电脑系统是 macOS Catalina 10.15.6（理论上 windows 和 mac 应该是一致的）。</p><p>Git 的配置分：</p><ul><li>system</li><li>global</li><li>local</li></ul><p>可以通过以下命令可以查看各自配置：</p><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> config --system --list
<span class="token function">git</span> config --global --list
<span class="token function">git</span> config --local --list
</code></pre><p>配置中相同 key，<code>system &lt; global &lt; local</code> 后者覆盖前者，所以我们需要记住这个规则。网络中通常教大家配置全局用户名（user.name）和邮箱（user.email），都是存放在 global 中。</p><h2 id="_1-移除之前的全局配置" tabindex="-1">1. 移除之前的全局配置 <a class="header-anchor" href="#_1-移除之前的全局配置" aria-hidden="true">#</a></h2><pre class="language-bash"><code class="language-bash"><span class="token comment"># 查看全局配置</span>
<span class="token function">git</span> config --global --list

<span class="token comment"># 若存在用户名和邮箱则清除</span>
<span class="token function">git</span> config --global --unset user.name
<span class="token function">git</span> config --global --unset user.email
</code></pre><h2 id="_2-生成不同账户的公私钥" tabindex="-1">2. 生成不同账户的公私钥 <a class="header-anchor" href="#_2-生成不同账户的公私钥" aria-hidden="true">#</a></h2><p>找到 <strong>.ssh</strong> 文件夹（如果自定义，进入你自定义文件夹）中，启动终端（这步网络上好多教程没有教，新手很容易不知道怎么回事），输入以下命令生成不同账户的公私钥。</p><blockquote><p>假设现在有两个账户:</p><ul><li>私人的 name: personal email: <a href="mailto:personal@fake.com">personal@fake.com</a></li><li>公司的 name: company email: <a href="mailto:company@fake.com">company@fake.com</a></li></ul></blockquote><pre class="language-bash"><code class="language-bash">ssh-keygen -t rsa -C <span class="token string">"your email"</span>

<span class="token comment"># 回车会出现以下提示，此时提示需要键入关键字（也是文件名），此时一定需要输入，因为默认生成的文件就叫做 id_rsa，如果不输入后续出提示覆盖文件</span>
<span class="token comment"># ssh-keygen -t rsa -C "personal@fake.com"</span>
<span class="token comment"># Enter file in which to save the key (~/.ssh/id_rsa): personal</span>
<span class="token comment"># ...(直接回车到结束)</span>
<span class="token comment"># ssh-keygen -t rsa -C "company@fake.com"</span>
<span class="token comment"># Enter file in which to save the key (~/.ssh/id_rsa): company</span>
<span class="token comment"># ...(直接回车到结束)</span>
</code></pre><h2 id="_3-登陆对应的仓库设置公私钥" tabindex="-1">3. 登陆对应的仓库设置公私钥 <a class="header-anchor" href="#_3-登陆对应的仓库设置公私钥" aria-hidden="true">#</a></h2><p>gitee，gitlab，github 对应设置教程请网上查阅。</p><h2 id="_4-在-ssh-文件夹新建文件名为-config-的文件（注意无尾缀）" tabindex="-1">4. 在 <strong>.ssh</strong> 文件夹新建文件名为 <strong>config</strong> 的文件（注意无尾缀） <a class="header-anchor" href="#_4-在-ssh-文件夹新建文件名为-config-的文件（注意无尾缀）" aria-hidden="true">#</a></h2><pre class="language-bash"><code class="language-bash"><span class="token comment"># personal</span>
Host PersonalHost <span class="token comment"># 区分大小写，建议直接全部小写，这样输入命令会好看点 :)，此处为了说明采用首字母大写</span>
HostName gitee.com
<span class="token comment"># 可省</span>
PreferredAuthentications publickey
<span class="token comment"># 可省</span>
<span class="token comment"># User person</span>
User <span class="token string">"your personal name"</span>
<span class="token comment"># 绝对路径</span>
IdentityFile /.ssh/personal

<span class="token comment"># company</span>
Host CompanyHost
HostName gitee.com
PreferredAuthentications publickey
<span class="token comment"># User company</span>
User <span class="token string">"your company name"</span>
IdentityFile /.ssh/company
</code></pre><h2 id="_5-私钥添加到本地" tabindex="-1">5. 私钥添加到本地 <a class="header-anchor" href="#_5-私钥添加到本地" aria-hidden="true">#</a></h2><pre class="language-bash"><code class="language-bash"><span class="token comment"># company, personal 是私钥文件名称，也就是刚刚需要你键入的关键字</span>
ssh-add ./company
ssh-add ./personal
</code></pre><h2 id="_6-测试使用提交代码" tabindex="-1">6. 测试使用提交代码 <a class="header-anchor" href="#_6-测试使用提交代码" aria-hidden="true">#</a></h2><pre class="language-bash"><code class="language-bash"><span class="token comment"># HostCompany, HostPersonal 是 config 文件中 Host 属性的对应名称</span>
<span class="token function">git</span> git@HostCompany:xxx/xxx.git
<span class="token function">git</span> git@HostPersonal:xxx/xxx.git
</code></pre><h2 id="_7-配置当前项目账户" tabindex="-1">7. 配置当前项目账户 <a class="header-anchor" href="#_7-配置当前项目账户" aria-hidden="true">#</a></h2><p>进入当前项目内，然后启动终端。然后键入以下命令配置 local config。</p><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> config user.name <span class="token string">"your account"</span> 
<span class="token function">git</span> config user.email <span class="token string">"your email"</span>
</code></pre><h2 id="_8-题外话" tabindex="-1">8. 题外话 <a class="header-anchor" href="#_8-题外话" aria-hidden="true">#</a></h2><h3 id="config-文件中属性介绍" tabindex="-1">config 文件中属性介绍 <a class="header-anchor" href="#config-文件中属性介绍" aria-hidden="true">#</a></h3><p>每个账号单独配置一个 <code>Host</code>，每个 <code>Host</code>要取一个别名，每个 <code>Host</code> 主要配置 <code>HostName</code> 和 <code>IdentityFile</code> 两个属性即可。</p><table><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>Host</td><td>随意取，不过会影响命令，如 <code>Host mygithub</code>，那么 <code>git@</code> 后面紧跟的名字改为 mygithub<code>git clone git@mygithub:xxx.git</code></td></tr><tr><td>HostName</td><td>真实的域名地址</td></tr><tr><td>IdentityFile</td><td>id_rsa 的地址，使用绝对地址</td></tr><tr><td>PreferredAuthentications</td><td>配置登录时用什么权限认证，可设为 <code>publickey</code>, <code>password</code>, <code>keyboard-interactive</code></td></tr><tr><td>User</td><td>配置使用用户名</td></tr></tbody></table><h3 id="如何修正之前提交的用户名和邮箱呢？" tabindex="-1">如何修正之前提交的用户名和邮箱呢？ <a class="header-anchor" href="#如何修正之前提交的用户名和邮箱呢？" aria-hidden="true">#</a></h3><p>git中最猛的后悔药，没有把握慎用。</p><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> filter-branch -f --commit-filter <span class="token string">'
  if [ "$GIT_COMMITTER_NAME" = "已提交的用户名" ];
    then
      GIT_COMMITTER_NAME="想要变成的用户名";
      GIT_AUTHOR_NAME="$GIT_COMMITTER_NAME";
      GIT_COMMITTER_EMAIL="想要变成的邮箱";
      GIT_AUTHOR_EMAIL="$GIT_COMMITTER_EMAIL";
      git commit-tree "$@";
    else
      git commit-tree "$@";
  fi'</span> HEAD
</code></pre><p>执行命令之后，此时用户名和邮箱都已经修改为想要变成的样子，再执行强制推向远程，要确保已经是最新的HEAD否则会覆盖他人编写的代码。（<code>HEAD</code> 可以修改为 <code>HEAD~5..HEAD</code> 表示最近的5个提交）</p><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> push --force
</code></pre><h3 id="git-filter-branch-妙用" tabindex="-1"><code>git filter-branch</code> 妙用 <a class="header-anchor" href="#git-filter-branch-妙用" aria-hidden="true">#</a></h3><p>如果在某次提交时提交了某个大文件或者敏感文件，虽然可以在下次提交中删除该文件，或者把该文件添加到 <code>.gitignore</code> 中，但是如果回溯到某个提交时那个文件还是存在，现在想要将所有历史的提交中移出该文件。</p><pre class="language-bash"><code class="language-bash"><span class="token comment"># 中间引号那一段是shell脚本</span>
<span class="token function">git</span> filter-branch --force --index-filter <span class="token string">'git rm --cached --ignore-unmatch path'</span> 
--prune-empty --tag-name-filter <span class="token function">cat</span> -- --all

<span class="token comment"># 强制推向远程，可能会覆盖他人的提交，所以称为最猛的后悔药</span>
<span class="token function">git</span> push --force
</code></pre></div><!--]--></article><div class="prose m-auto mt-8 mb-8"><a href="/posts" class="font-mono no-underline opacity-50 hover:opacity-75">cd ..</a></div><!--]--><footer class="prose m-auto py-20 flex"><span class="text-sm">2018 - PRESENT © HeZulong</span><div class="flex-auto"></div></footer></main><!--]--></div><script></script></body></html>